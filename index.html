<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BWR Marketplace</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="header">
    <div class="header-left">
        <h1>BWR Marketplace</h1>

        <div class="tabs">
            <button class="tab active" data-section="marketplace" title="Marketplace">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.7 13.3a2 2 0 0 0 2 1.7h9.6a2 2 0 0 0 2-1.7L23 6H6"></path>
                </svg>
            </button>

            <!-- Jobs -->
            <button class="tab" data-section="jobs" title="Jobs">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                    <rect x="2" y="7" width="20" height="14" rx="2"></rect>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
            </button>

            <!-- Search -->
            <button class="tab" data-section="search" title="Search">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                    <circle cx="11" cy="11" r="7"></circle>
                    <line x1="16" y1="16" x2="22" y2="22"></line>
                </svg>
            </button>
        </div>
    </div>

    <button id="actionBtn" class="action-btn" onclick="openModal('itemModal')">+</button>
</div>

<div class="container">

    <div id="marketplace" class="section active">
        <div id="items" class="items-grid">
            <div class="loading">Loading items...</div>
        </div>
    </div>

    <div id="jobs" class="section">
        <div id="job-listings" class="jobs-grid">
            <div class="loading">Loading jobs...</div>
        </div>
    </div>

    <div id="search" class="section">
        <input type="text" id="searchInput" class="search-box" placeholder="Search items...">
        <div id="searchResults" class="items-grid"></div>
    </div>

</div>

<div id="itemModal" class="modal" onclick="closeModalOnOutside(event, 'itemModal')">
    <div class="modal-content">
        <div class="modal-header">
            <h2>List Your Item</h2>
            <button class="close-btn" onclick="closeModal('itemModal')">&times;</button>
        </div>

        <form id="itemForm">
            <div class="form-group"><input id="name" placeholder="Name" required></div>
            <div class="form-group"><input id="price" placeholder="Price" required></div>
            <div class="form-group"><input id="image" placeholder="Image URL" required></div>
            <div class="form-group"><input id="telegram" placeholder="@telegram" required></div>
            <div class="form-group">
                <textarea id="description" placeholder="Description (optional)"></textarea>
            </div>
            <div class="form-group">
                <label><input type="checkbox" id="used"> Used</label>
            </div>
            <button class="submit-btn marketplace-submit">Submit</button>
        </form>
    </div>
</div>

<div id="jobModal" class="modal" onclick="closeModalOnOutside(event, 'jobModal')">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Post a Job</h2>
            <button class="close-btn" onclick="closeModal('jobModal')">&times;</button>
        </div>

        <form id="jobForm">
            <div class="form-group"><input id="business-name" placeholder="Business Name" required></div>
            <div class="form-group"><input id="payment" placeholder="Payment" required></div>
            <div class="form-group"><input id="job-image" placeholder="Image URL" required></div>
            <div class="form-group"><input id="job-telegram" placeholder="@telegram" required></div>
            <div class="form-group">
                <textarea id="job-description" placeholder="Description"></textarea>
            </div>
            <button class="submit-btn job-submit">Submit</button>
        </form>
    </div>
</div>

<script>
/* CONFIG */
const GITHUB_USERNAME = "foretpzs";
const GITHUB_REPO = "Bobbank";

document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        const section = tab.dataset.section;
        document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
        document.getElementById(section).classList.add("active");

        const actionBtn = document.getElementById("actionBtn");

        if (section === "marketplace") {
            actionBtn.onclick = () => openModal("itemModal");
        } else if (section === "jobs") {
            actionBtn.onclick = () => openModal("jobModal");
        } else {
            actionBtn.onclick = () => {};
        }
    });
});

function openModal(id) { document.getElementById(id).classList.add("active"); }
function closeModal(id) { document.getElementById(id).classList.remove("active"); }
function closeModalOnOutside(e, id) { if (e.target.id === id) closeModal(id); }

async function loadItems() {
    const res = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/issues?labels=marketplace-item&state=open`
    );

    const issues = await res.json();
    const box = document.getElementById("items");

    box.innerHTML = issues.map(i => {
        const name = i.body.match(/\*\*Name:\*\* (.+)/)?.[1] || "Unknown";
        const price = i.body.match(/\*\*Price:\*\* (.+)/)?.[1] || "-";
        const img = i.body.match(/\*\*Image:\*\* (.+)/)?.[1] || "";
        const tg = i.body.match(/\*\*Telegram:\*\* (.+)/)?.[1] || "";
        const isUsed = i.body.match(/\*\*Condition:\*\* (.+)/)?.[1] === "Used";
        const desc = i.body.match(/\*\*Description:\*\*\s*\n([\s\S]+)/)?.[1] || "";

        return `
        <div class="item-card">
            <img src="${img}" class="item-image">
            <div class="item-content">
                <div class="condition-badge ${isUsed ? "condition-used" : "condition-new"}">
                    ${isUsed ? "Used" : "New"}
                </div>
                <div class="item-name">${name}</div>
                <div class="item-price">${price}</div>
                <div class="item-description">${desc}</div>
                <a href="https://t.me/${tg.replace("@","")}" class="contact-btn marketplace-contact">Contact</a>
            </div>
        </div>`;
    }).join("");
}

async function loadJobs() {
    const res = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/issues?labels=BWR-JOB&state=open`
    );
    const issues = await res.json();
    const box = document.getElementById("job-listings");

    box.innerHTML = issues.map(i => {
        const business = i.body.match(/\*\*Business:\*\* (.+)/)?.[1] || "Business";
        const payment = i.body.match(/\*\*Payment:\*\* (.+)/)?.[1] || "";
        const img = i.body.match(/\*\*Image:\*\* (.+)/)?.[1] || "";
        const tg = i.body.match(/\*\*Telegram:\*\* (.+)/)?.[1] || "";
        const desc = i.body.match(/\*\*Description:\*\*\s*\n([\s\S]+)/)?.[1] || "";

        return `
        <div class="job-card">
            <img src="${img}" class="job-image">
            <div class="job-content">
                <div class="payment-badge">${payment}</div>
                <div class="job-name">${business}</div>
                <div class="job-description">${desc}</div>
                <a href="https://t.me/${tg.replace("@","")}" class="contact-btn job-contact">Contact</a>
            </div>
        </div>`;
    }).join("");
}

document.getElementById("searchInput").addEventListener("input", async e => {
    const q = e.target.value.toLowerCase().trim();
    const res = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/issues?labels=marketplace-item&state=open`
    );
    const issues = await res.json();
    const results = document.getElementById("searchResults");

    results.innerHTML = issues
        .filter(i => i.title.toLowerCase().includes(q))
        .map(i => {
            const name = i.body.match(/\*\*Name:\*\* (.+)/)?.[1] || "";
            const price = i.body.match(/\*\*Price:\*\* (.+)/)?.[1] || "";
            const img = i.body.match(/\*\*Image:\*\* (.+)/)?.[1] || "";
            return `
            <div class="item-card">
                <img src="${img}" class="item-image">
                <div class="item-content">
                    <div class="item-name">${name}</div>
                    <div class="item-price">${price}</div>
                </div>
            </div>`;
        }).join("");
});

/* INIT */
loadItems();
loadJobs();
</script>

</body>
</html>
