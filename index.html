<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BWR Marketplace</title>
    <style>
        :root{
            --bg-900: #001B46; /* deep blue */
            --bg-800: #0b1630;
            --panel: #0f2345;
            --muted: #546886;
            --ice: #D2E4FF; /* light blue */
            --pink: #F187B7;
            --pink-deep: #97194F;
            --white: #FFFFFF;
            --black: #000000;
            --glass: rgba(255,255,255,0.04);
            --card-border: rgba(255,255,255,0.06);
            --radius: 10px;
            --shadow: 0 6px 18px rgba(2,6,23,0.6);
            --transition: 220ms cubic-bezier(.2,.9,.3,1);
        }

        *{box-sizing:border-box;margin:0;padding:0}
        html,body{height:100%}
        body{
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            background: linear-gradient(180deg, var(--bg-900) 0%, #021233 60%);
            color: var(--ice);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            line-height:1.45;
            padding-bottom:60px;
        }

        .header{
            background: linear-gradient(90deg, rgba(152,25,79,0.12), rgba(17,34,77,0.12));
            border-bottom: 1px solid rgba(255,255,255,0.04);
            padding:18px 36px;
            display:flex;align-items:center;justify-content:space-between;
            gap:16px;backdrop-filter: blur(6px);
            position:sticky;top:0;z-index:50
        }

        .brand{
            display:flex;align-items:center;gap:14px
        }

        .logo{
            width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;
            background: linear-gradient(135deg,var(--pink) 0%, var(--ice) 100%);
            color:var(--black);font-weight:700;font-size:16px;box-shadow: 0 6px 18px rgba(25,8,30,0.5);
        }

        .header h1{font-size:18px;color:var(--ice);font-weight:700}

        .controls{display:flex;gap:12px;align-items:center}

        .sell-btn{
            background: linear-gradient(90deg,var(--pink) 0%, var(--pink-deep) 100%);
            color:var(--white);border:0;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer;
            box-shadow: 0 8px 24px rgba(217,93,138,0.16);transition:transform var(--transition), box-shadow var(--transition);
        }
        .sell-btn:hover{transform:translateY(-3px);box-shadow: 0 14px 36px rgba(217,93,138,0.22)}

        .container{max-width:1200px;margin:28px auto;padding:20px}

        .items-grid{
            display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;
        }

        .item-card{
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border:1px solid var(--card-border);
            border-radius:var(--radius);overflow:hidden;transition:transform var(--transition), box-shadow var(--transition), border-color var(--transition);
            box-shadow: var(--shadow);
        }
        .item-card:hover{transform:translateY(-6px);border-color: rgba(210,228,255,0.18)}

        .item-image{width:100%;height:180px;object-fit:cover;background:linear-gradient(135deg,#021633, #081b36);display:block}

        .item-content{padding:14px}
        .condition-badge{
            display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px;margin-bottom:8px;
        }
        .condition-new{background:linear-gradient(90deg, rgba(210,228,255,0.12), rgba(36,70,126,0.12));color:var(--ice);border:1px solid rgba(210,228,255,0.06)}
        .condition-used{background:linear-gradient(90deg, rgba(241,135,183,0.08), rgba(151,25,79,0.06));color:var(--pink);border:1px solid rgba(241,135,183,0.06)}

        .item-name{font-size:15px;color:var(--ice);font-weight:700;margin:8px 0}
        .item-price{font-size:18px;font-weight:800;color:var(--pink);margin-bottom:10px}
        .item-description{color:var(--muted);font-size:13px;margin-bottom:12px}

        .contact-btn{
            display:inline-block;background:linear-gradient(90deg,#2bb673,#238636);color:white;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700;font-size:13px;transition:transform var(--transition);
        }
        .contact-btn:hover{transform:translateY(-3px)}

        .loading{text-align:center;padding:48px 12px;color:var(--muted)}

        /* modal */
        .modal{display:none;position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.64));z-index:150;align-items:center;justify-content:center;padding:28px}
        .modal.active{display:flex}
        .modal-content{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--card-border);padding:20px;border-radius:14px;width:680px;max-width:96%;box-shadow:0 20px 60px rgba(3,7,18,0.8)}

        .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
        .modal-header h2{font-size:18px;color:var(--ice)}
        .close-btn{background:transparent;border:0;color:var(--muted);font-size:26px;cursor:pointer}
        .close-btn:hover{color:var(--ice)}

        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .form-group{margin-bottom:12px}
        label{display:block;font-weight:700;font-size:13px;color:var(--ice);margin-bottom:6px}
        input[type=text],input[type=url],textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--ice);font-size:14px}
        input:focus,textarea:focus{outline:none;border-color:rgba(210,228,255,0.24);box-shadow:0 6px 20px rgba(10,22,60,0.45)}
        textarea{min-height:96px;resize:vertical}

        .submit-btn{width:100%;padding:12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--ice),rgba(210,228,255,0.9));color:var(--bg-900);font-weight:800;cursor:pointer;margin-top:6px}
        .submit-btn:hover{transform:translateY(-3px)}

        .required{color:var(--pink)}

        /* responsive tweaks */
        @media (max-width:720px){
            .form-grid{grid-template-columns:1fr}
            .item-image{height:160px}
            .modal-content{padding:16px}
            .logo{width:40px;height:40px}
        }

        /* subtle footer */
        .foot-note{max-width:1200px;margin:12px auto;color:var(--muted);font-size:13px;text-align:center}
    </style>
</head>
<body>
    <div class="header">
        <div class="brand">
            <div class="logo">BWR</div>
            <div>
                <h1>BWR Marketplace</h1>
                <div style="font-size:12px;color:var(--muted);margin-top:2px">Buy & Sell — Pink × Blue theme</div>
            </div>
        </div>

        <div class="controls">
            <button class="sell-btn" onclick="openModal()">+ Sell Item</button>
        </div>
    </div>

    <div class="container">
        <div id="items" class="items-grid">
            <div class="loading">Loading items...</div>
        </div>
    </div>

    <div id="modal" class="modal" onclick="closeModalOnOutside(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2>List Your Item</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="itemForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">Name <span class="required">*</span></label>
                        <input type="text" id="name" required placeholder="Название Товара">
                    </div>
                    <div class="form-group">
                        <label for="price">Price <span class="required">*</span></label>
                        <input type="text" id="price" required placeholder="Цена товара">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="image">Image URL <span class="required">*</span></label>
                        <input type="url" id="image" required placeholder="https://example.com/image.jpg">
                    </div>
                    <div class="form-group">
                        <label for="telegram">Telegram <span class="required">*</span></label>
                        <input type="text" id="telegram" required placeholder="@юз продавца">
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" placeholder="Oпционально описание.."></textarea>
                </div>

                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                    <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                        <input type="checkbox" id="used" style="width:18px;height:18px">
                        <span style="font-weight:700;color:var(--ice)">Б/У (Used)</span>
                    </label>
                    <div style="color:var(--muted);font-size:13px">Tip: listings are created as GitHub issues and opened in a new tab.</div>
                </div>

                <button type="submit" class="submit-btn">Create Listing</button>
            </form>
        </div>
    </div>

    <div class="foot-note">Theme palette: <span style="color:var(--ice)">#D2E4FF</span> · <span style="color:var(--pink)">#F187B7</span> · <span style="color:var(--pink-deep)">#97194F</span> · <span style="color:#001B46">#001B46</span></div>

    <script>
        // CONFIGURE THESE
        const GITHUB_USERNAME = 'foretpzs';
        const GITHUB_REPO = 'Bobbank';

        function openModal(){document.getElementById('modal').classList.add('active');document.getElementById('name').focus();}
        function closeModal(){document.getElementById('modal').classList.remove('active');}
        function closeModalOnOutside(e){ if(e.target.id === 'modal') closeModal(); }

        async function loadItems(){
            try{
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/issues?labels=marketplace-item&state=open`);
                const issues = await response.json();
                const container = document.getElementById('items');

                if(!Array.isArray(issues) || issues.length === 0){
                    container.innerHTML = '<div class="loading">No items yet. Click "Sell Item" to list the first one!</div>';
                    return;
                }

                container.innerHTML = issues.map(issue => {
                    const body = issue.body || '';
                    const name = (body.match(/\*\*Name:\*\*\s*(.+)/)?.[1] || issue.title || 'Unknown').trim();
                    const price = (body.match(/\*\*Price:\*\*\s*(.+)/)?.[1] || 'N/A').trim();
                    const image = (body.match(/\*\*Image:\*\*\s*(.+)/)?.[1] || '').trim();
                    const telegram = (body.match(/\*\*Telegram:\*\*\s*(.+)/)?.[1] || '').trim();
                    const description = (body.match(/\*\*Description:\*\*[\r\n]+([\s\S]+)/)?.[1] || '').trim();
                    const isUsed = (body.match(/\*\*Condition:\*\*\s*(.+)/)?.[1] || '').trim().toLowerCase() === 'used';

                    // sanitize values for HTML injection safety in this simple example
                    const esc = (s)=> String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

                    return `\n                        <div class="item-card">\n                            <img src="${esc(image)}" alt="${esc(name)}" class="item-image" onerror="this.src='https://via.placeholder.com/420x280/001B46/D2E4FF?text=No+Image'">\n                            <div class="item-content">\n                                <div class="condition-badge ${isUsed? 'condition-used':'condition-new'}">\n                                    ${isUsed? 'Б/У' : 'Новый'}\n                                </div>\n                                <div class="item-name">${esc(name)}</div>\n                                <div class="item-price">${esc(price)}</div>\n                                ${description? `<div class="item-description">${esc(description)}</div>`: ''}\n                                ${telegram? `<a href="https://t.me/${esc(telegram.replace('@',''))}" target="_blank" class="contact-btn">Contact Seller</a>` : `<div style="color:var(--muted);font-size:13px">No contact provided</div>`}\n                            </div>\n                        </div>\n                    `;
                }).join('');
            }catch(err){
                console.error(err);
                document.getElementById('items').innerHTML = '<div class="loading">Error loading items. Check your GitHub configuration or rate limits.</div>';
            }
        }

        document.getElementById('itemForm').addEventListener('submit',(e)=>{
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const price = document.getElementById('price').value.trim();
            const image = document.getElementById('image').value.trim();
            const telegram = document.getElementById('telegram').value.trim();
            const description = document.getElementById('description').value.trim();
            const isUsed = document.getElementById('used').checked;

            if(!name || !price || !image || !telegram){
                alert('Please fill required fields.');
                return;
            }

            const issueBody = `**Name:** ${name}\n**Price:** ${price}\n**Image:** ${image}\n**Telegram:** ${telegram}\n**Condition:** ${isUsed ? 'Used' : 'New'}\n**Description:**\n${description || 'No description'}`;

            const issueUrl = `https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO}/issues/new?title=${encodeURIComponent(name)}&body=${encodeURIComponent(issueBody)}&labels=marketplace-item`;

            window.open(issueUrl,'_blank');
            closeModal();
        });

        // initial load
        loadItems();
    </script>
</body>
</html>
